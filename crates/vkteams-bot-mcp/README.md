# VKTeams Bot MCP Server

[![crates.io](https://img.shields.io/crates/v/vkteams-bot-mcp)](https://crates.io/crates/vkteams-bot-mcp)
[![codecov](https://codecov.io/github/bug-ops/vkteams-bot/graph/badge.svg?token=XV23ZKSZRA&flag=vkteams-bot-mcp)](https://codecov.io/github/bug-ops/vkteams-bot)
[![Unsafe forbidden](https://img.shields.io/badge/unsafe-forbidden-success.svg)](https://github.com/rust-secure-code/safety-dance/)

**A Model Context Protocol (MCP) server for VK Teams Bot API.**
Easily integrate VK Teams bots with LLM agents, automation systems, or any external service via a universal protocol.

---

## ✨ Features

- 📤 **Send Messages**: Send text messages to VK Teams chats via MCP
- 📎 **Enhanced File Uploads**: Upload files directly from LLM with multiple formats
- 🔄 **File Conversion**: Automatic format conversion (text, JSON, CSV)
- 📝 **Smart File Handling**: Base64 upload, text-to-file, batch uploads
- 🤖 **Bot Info**: Retrieve bot information
- 💬 **Chat Management**: Full chat control (members, admins, settings)
- 📁 **File Info**: Query file metadata and validation
- 📡 **Event Streaming**: Receive chat and bot events
- 🔌 **Universal Integration**: Works over stdin/stdout, perfect for LLMs and automation

---

## Quick Start

### 1. Set Environment Variables

```bash
export VKTEAMS_BOT_API_TOKEN=your_token_here
export VKTEAMS_BOT_API_URL=https://your-api-url
export VKTEAMS_BOT_CHAT_ID=your_chat_id
```

### 2. Build and Run

```bash
cargo build --release
./target/release/vkteams-bot-mcp
```

### 3. Example MCP Requests

#### Send a text message

```json
{
  "tool": "send_text",
  "params": {
    "text": "Hello, world!"
  }
}
```

#### Upload a file from base64

```json
{
  "tool": "upload_file_from_base64",
  "params": {
    "file_name": "document.txt",
    "base64_content": "SGVsbG8gV29ybGQh",
    "caption": "Here's the document you requested"
  }
}
```

#### Upload text as a file

```json
{
  "tool": "upload_text_as_file",
  "params": {
    "file_name": "script.py",
    "text_content": "print('Hello from Python!')",
    "caption": "Python script generated by AI"
  }
}
```

---

## Usage

The server communicates via the [MCP protocol](https://github.com/modelcontextprotocol/rust-sdk) over standard input/output.
You can connect it to LLM agents, automation scripts, or use it as a standalone service.

### Supported Tools

#### Core Bot Operations

- `send_text` — Send a text message to the chat
- `self_get` — Get bot information
- `chat_info` — Get chat information
- `file_info` — Get file information
- `events_get` — Get events from the chat

#### Enhanced File Upload

- `upload_file_from_base64` — Upload file from base64 encoded content
- `upload_text_as_file` — Create and upload text content as a file
- `upload_json_file` — Create and upload structured JSON files
- `upload_csv_file` — Generate and upload CSV files from data
- `upload_code_file` — Upload source code with syntax highlighting
- `upload_multiple_files` — Batch upload multiple files at once
- `validate_file_before_upload` — Validate file content before uploading
- `upload_with_conversion` — Upload with automatic format conversion

#### Message Management

- `send_file` — Send file to chat
- `send_voice` — Send voice message
- `edit_message` — Edit existing message
- `delete_message` — Delete message from chat
- `pin_message` — Pin message in chat
- `unpin_message` — Unpin message in chat

#### Chat Management

- `get_chat_members` — Get list of chat members
- `get_chat_admins` — Get chat administrators
- `get_chat_pending_users` — Get pending users
- `get_chat_blocked_users` — Get blocked users
- `set_chat_title` — Set chat title
- `set_chat_about` — Set chat description
- `set_chat_rules` — Set chat rules
- `set_chat_avatar` — Set chat avatar
- `send_action` — Send typing/looking indicators
- `block_user` — Block user in chat
- `unblock_user` — Unblock user in chat
- `delete_chat_members` — Remove members from chat
- `resolve_pending` — Approve or reject pending users

---

## File Upload Capabilities

The server includes advanced file handling with automatic validation, format conversion, and batch processing:

### Supported File Types

- **Text files**: `.txt`, `.md`, `.json`, `.xml`, `.csv`, `.log`
- **Code files**: `.rs`, `.py`, `.js`, `.ts`, `.html`, `.css`, `.sql`
- **Images**: `.png`, `.jpg`, `.jpeg`, `.gif`, `.svg`, `.webp`
- **Documents**: `.pdf`, `.doc`, `.docx`, `.xls`, `.xlsx`
- **Archives**: `.zip`, `.tar`, `.gz`, `.7z`
- **Audio/Video**: `.mp3`, `.wav`, `.ogg`, `.mp4`, `.avi`

### File Validation

- Automatic filename sanitization
- File size validation (max 10MB)
- Content type detection
- Base64 encoding/decoding
- MIME type identification

### Advanced Features

- Batch file uploads (up to 10 files)
- Automatic format conversion (text ↔ JSON ↔ CSV)
- Code syntax highlighting
- File metadata extraction
- Progress reporting for batch operations

---

## Documentation

- [VK Teams Bot API](https://teams.vk.com/botapi/?lang=en)
- [MCP Protocol (MCP)](https://modelcontextprotocol.io/specification/2025-03-26)
